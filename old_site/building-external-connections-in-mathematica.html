<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Required meta tags always come first -->
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>
Building External Connections in Mathematica |         b3m2a1

</title>
  <link rel="canonical" href="https://b3m2a1.github.io/building-external-connections-in-mathematica.html">

  <link rel="alternate" type="application/atom+xml" href="https://b3m2a1.github.io/feeds/all.atom.xml" title="Full Atom Feed">

  <link rel="apple-touch-icon" href="https://b3m2a1.github.io/apple-touch-icon.png" sizes="180x180">
  <link rel="icon" type="image/png" href="https://b3m2a1.github.io/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="https://b3m2a1.github.io/favicon-16x16.png" sizes="16x16">
  <link rel="manifest" href="https://b3m2a1.github.io/manifest.json">
  <meta name="theme-color" content="#333333">

  <link rel="stylesheet" href="https://b3m2a1.github.io/theme/css/bootstrap.css">
  <link rel="stylesheet" href="https://b3m2a1.github.io/theme/css/font-awesome.css">
  <link rel="stylesheet" href="https://b3m2a1.github.io/theme/css/style.css">


<meta name="description" content="This builds off of something I brought up on StackExchange a bit ago as well as some recent work I've done in building a nicer interface to Git and GitHub . I'm hoping to mainly lay out in a brief fashion how one can tackle the really broad question of how â€¦">

<link href="https://b3m2a1.github.io/theme/prettify/styles/prettify-mma.min.css" rel="stylesheet">
<script src="https://b3m2a1.github.io/theme/prettify/src/prettify.js"></script>
<!-- <script src="https://b3m2a1.github.io/theme/prettify/src/lang-mma.min.js"></script> -->

<script>
  function moveWindow (){window.location.hash="main-content";}
</script>


<script>
  (function(i, s, o, g, r, a, m) {
    i['GoogleAnalyticsObject'] = r;
    i[r] = i[r] || function() {
      (i[r].q = i[r].q || []).push(arguments)
    }, i[r].l = 1 * new Date();
    a = s.createElement(o);
    a.async = 1;
    a.src = g;
    m = s.getElementsByTagName(o)[0];
    m.parentNode.insertBefore(a, m)
  })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');
  ga('create', 'UA-103560228-1', 'auto');
  ga('send', 'pageview');
</script>

  <script>
    function openNav() {
      var thumb = document.getElementById("nav-thumb");
      var bar = document.getElementById("side-nav");
      thumb.onclick= closeNav;
      bar.classList.add("right-bar-open");
      bar.classList.remove("right-bar-closed");
      thumb.classList.add("nav-thumb-open");
      thumb.classList.remove("nav-thumb-closed");
    }

    function closeNav() {
      var thumb = document.getElementById("nav-thumb");
      var bar = document.getElementById("side-nav");
      thumb.onclick= openNav;
      bar.classList.remove("right-bar-open");
      bar.classList.add("right-bar-closed");
      thumb.classList.remove("nav-thumb-open");
      thumb.classList.add("nav-thumb-closed")
    }
  </script>


</head>

<body onload="PR.prettyPrint(); moveWindow()"
>
  <header class="header">
    <div class="top-bar">
    <div class="site-image">
      <img src=https://b3m2a1.github.io/img/site-image.png alt="b3m2a1">
    </div>
    <div class="site-links bubble floating">
      <h1 class="title">
          <a href="https://b3m2a1.github.io/">
            b3m2a1
          </a>
        </h1>
        <ul
          class="list-inline row site-link-row"
          id="top-bar-link-row"
          >
            <li class="list-inline-item site-link">
              <a href="https://b3m2a1.github.io/pages/about.html">About</a>
            </li>
            <li class="list-inline-item site-link">
              <a href="https://b3m2a1.github.io/pages/contact.html">Contact</a>
            </li>
            <li class="list-inline-item site-link">
              <a href="https://b3m2a1.github.io/categories.html">Categories</a>
            </li>
            <li class="list-inline-item site-link">
              <a href="https://b3m2a1.github.io/tags.html">Tags</a>
            </li>
            <li class="list-inline-item site-link">
              <a href="https://b3m2a1.github.io/archives.html">Archives</a>
            </li>
        </ul>
    </div>
    </div>
  </header>

  <div class="main" id="main-content">

    <div class="right-bar right-bar-closed" id="side-nav">
      <button
        id="nav-thumb"
        class="nav-thumb nav-thumb-closed"
        onclick="openNav()"
        >
      </button>
      <div class="blogroll bubble inset">
        <p>Links</p>
        <ul class="blogroll-links right-bar-links list-inline">
            <li class="right-bar-item">
              <a href="https://github.com/b3m2a1" class="blogroll-link right-bar-link"
                target="_blank">
                GitHub
              </a>
            </li>
            <li class="right-bar-item">
              <a href="https://mathematica.stackexchange.com/users/38205" class="blogroll-link right-bar-link"
                target="_blank">
                StackExchange
              </a>
            </li>
            <li class="right-bar-item">
              <a href="https://paclets.github.io/PacletServer" class="blogroll-link right-bar-link"
                target="_blank">
                Paclet Server
              </a>
            </li>
            <li class="right-bar-item">
              <a href="https://www.wolframcloud.com/objects/b3m2a1.docs/DocumentationServer/" class="blogroll-link right-bar-link"
                target="_blank">
                Docs
              </a>
            </li>
          </ul>
      </div>
    </div>

    <div class="left-content">
      <div class="container">
        <h1>Building External Connections in Mathematica
</h1>
        <hr>
<article class="article">
  <header>
    <ul class="list-inline">
      <li class="list-inline-item text-muted" title="2018-03-21T01:34:24-05:00">
        <i class="fa fa-clock-o"></i>
        Wed 21 March 2018
      </li>
      <li class="list-inline-item">
        <i class="fa fa-folder-open-o"></i>
        <a href="https://b3m2a1.github.io/category/posts.html">posts</a>
      </li>
      <li class="list-inline-item">
        <i class="fa fa-user-o"></i>
        <a href="https://b3m2a1.github.io/author/b3m2a1.html">b3m2a1</a>      </li>
      <li class="list-inline-item">
        <i class="fa fa-files-o"></i>
        <a href="https://b3m2a1.github.io/tag/mathematica.html">#mathematica</a>      </li>
    </ul>
  </header>
  <div class="content">
    <p>This builds off of something I brought up on  <a href="https://mathematica.stackexchange.com/q/166557/38205">StackExchange a bit ago</a>  as well as some recent work I've done in building a nicer  <a href="https://github.com/b3m2a1/mathematica-tools/blob/master/GitConnection.wl">interface to Git and GitHub</a> .</p>
<p>I'm hoping to mainly lay out in a brief fashion how one can tackle the really broad question of how to build interfaces and what tricks can be used to make them nice.</p>
<p>There are many possible classifications for these types of interfaces, but the major two I've run into are:</p>
<ul>
<li>
<p>Restricted interfaces<br />
    by this I mean interfaces where there is a proscribed set of functionality the interface should implement. Examples of this include APIs, CLI tools, and some packages.</p>
</li>
<li>
<p>Unrestricted interfaces<br />
    by this I mean interfaces where there is a highly-flexible set of functionality that we want to implement. The major example of this is programming languages.</p>
</li>
</ul>
<p>I'll discuss the restricted case first as it's much easier to handle</p>
<p><a id="restricted-interfaces" style="width:0;height:0;margin:0;padding:0;">&zwnj;</a></p>
<h2>Restricted Interfaces</h2>
<h3>Git</h3>
<p>When linking to Git there's a very small set of commands you really need to include. You can pretty much just look at the  <a href="https://git-scm.com/book/en/v2">git book</a>  and determine what you need to include.</p>
<p>Once you've done that, all you really need to do is write a general-purpose wrapper function for running Git and then register a bunch of different functions that do minor work on top of that.</p>
<p>I put this into a  <a href="https://github.com/b3m2a1/mathematica-BTools/blob/master/Packages/External/GitConnection.m">subpackage of my main application</a> . You can go there for all the details. In essence, though, I just wrote a bunch of little functions to handle different parts of the Git process. For example, here's how I registered the  <code>GitAdd</code>  function:</p>
<pre class="prettyprint"><code>GitRegisterFunction[GitAdd, &quot;add&quot;,
 {
  &quot;DryRun&quot;-&gt;&quot;dry-run&quot;,
  &quot;Verbose&quot;-&gt;&quot;verbose&quot;,
  &quot;Force&quot;-&gt;&quot;force&quot;,
  &quot;Interactive&quot;-&gt;&quot;interactive&quot;,
  &quot;Patch&quot;-&gt;&quot;patch&quot;,
  &quot;Edit&quot;-&gt;&quot;edit&quot;,
  &quot;Update&quot;-&gt;&quot;update&quot;,
  &quot;NoIgnoreRemoval&quot;-&gt;&quot;no-ignore-removal&quot;,
  &quot;IgnoreRemoval&quot;-&gt;&quot;ignore-removal&quot;,
  &quot;IntentToAdd&quot;-&gt;&quot;intent-to-add&quot;,
  &quot;Refresh&quot;-&gt;&quot;refresh&quot;,
  &quot;IgnoreErrors&quot;-&gt;&quot;ignore-errors&quot;,
  &quot;IgnoreMissing&quot;-&gt;&quot;ignore-missing&quot;,
  &quot;NoWarnEmbeddedRepo&quot;-&gt;&quot;no-warn-embedded-repo&quot;,
  &quot;ChangeModee&quot;-&gt;&quot;chmod&quot;
  }
 ]</code></pre>


<p>This just defines the function  <code>GitAdd</code> , the git command to call  <code>"add"</code> , and the way to map Mathematica options to Git options.</p>
<p>Once I had all the functions I wanted I cooked them into a single  <code>Association</code>  to act as a router from a name to a method:</p>
<pre class="prettyprint"><code>$GitActions=
 &lt;|
  &quot;Create&quot;-&gt;
   GitCreate,
  &quot;Init&quot;-&gt;
   GitInit,
  &quot;Clone&quot;-&gt;
   GitClone,
  &quot;AddGitIgnore&quot;-&gt;
   GitAddGitIgnore,
  &quot;AddGitExclude&quot;-&gt;
   GitAddGitExclude,
  &quot;Add&quot;-&gt;
   GitAdd,
  &quot;Move&quot;-&gt;
   GitMove,
  ...,
  &quot;Archive&quot;-&gt;
   GitArchive,
  &quot;SVN&quot;-&gt;
   GitSVN,
  &quot;Bundle&quot;-&gt;
   GitBundle,
  &quot;Daemon&quot;-&gt;
   GitDaemon,
  &quot;Help&quot;-&gt;
   GitHelp,
  &quot;HelpSynopsis&quot;-&gt;
   GitHelpSynopsis,
  &quot;HelpDescription&quot;-&gt;
   GitHelpDescription,
  &quot;HelpOptions&quot;-&gt;
   GitHelpOptions,
  &quot;HelpFlags&quot;-&gt;
   GitHelpFlags,
  &quot;HelpFlagMap&quot;-&gt;
   GitHelpFlagMap
  |&gt;;</code></pre>


<p>And I define a single function that provides the true interface to Git. I called that one  <code>Git</code> . Then you can define it (with unnecessary parts excised) like:</p>
<pre class="prettyprint"><code>Git[
 command_?(KeyMemberQ[$gitactions,ToLowerCase@#]&amp;),
 args___
 ]:=
 With[{cmd=$gitactions[ToLowerCase[command]]},
  With[{r=cmd[args]},
   r/;Head[r]=!=cmd
   ]
  ];</code></pre>


<p>And even better you can add autocompletions and things to make it easy to know what's there to use. E.g.:</p>
<pre class="prettyprint"><code>&lt;&lt;BTools`External`</code></pre>


<p><img alt="building-external-connections-in-mathematica-7072602429701907198" src="https://b3m2a1.github.io/img/building-external-connections-in-mathematica-7072602429701907198.png" /></p>
<p>And then can do things like:</p>
<pre class="prettyprint"><code>Git[&quot;HelpDescription&quot;, &quot;rm&quot;]</code></pre>


<pre class="program"><code style="width: 100%; white-space: pre-wrap;">-----------Out-----------
"Remove files from the index, or from the working tree and the index.\ngit rm will not remove a file from just your working directory. (There\nis no option to remove a file only from the working tree and yet keep\nit in the index; use //bin//rm if you want to do that.) The files being\nremoved have to be identical to the tip of the branch, and no updates\nto their contents can be staged in the index, though that default\nbehavior can be overridden with the --f option. When ----cached is given,\nthe staged content has to match either the tip of the branch or the\nfile on disk, allowing the file to be removed from just the index."</code></pre>

<h3>GitHub</h3>
<p>In that package I do a similar thing for GitHub's API, except with the important exception that the default operation for each registered function isn't to actually call the API but rather to build the  <a href="https://reference.wolfram.com/language/ref/HTTPRequest.html"><code>HTTPRequest</code></a>  that the function will actually use.</p>
<p><a id="unrestricted-interfaces" style="width:0;height:0;margin:0;padding:0;">&zwnj;</a></p>
<h2>Unrestricted Interfaces</h2>
<h3>Python</h3>
<p>I developed a package for linking to python that I called  <a href="https://github.com/b3m2a1/mathematica-PyTools">PyTools</a> .</p>
<p>To marshal Mathematica code down to a python representation I built out a  <a href="https://github.com/b3m2a1/mathematica-PyTools/blob/master/Packages/Symbolic/SymbolicPython.m">symbolic Python package</a> . This type of  <em>symbolic conversion</em>  is a powerful way to build an interface. In it Mathematica constructs are reduced to an intermediate  <em>symbolic</em>  representation which Mathematica can still easily manipulate and then further processing directions are defined on this symbolic form.</p>
<p>As an example, we'll see how I did it for this package. First load the package:</p>
<pre class="prettyprint"><code>&lt;&lt;PyTools`Symbolic`</code></pre>


<p>Then you can take a Mathematica expression and convert it into a symbolic representation of a python expression. In general this is set up so your write python-like code in Mathematica:</p>
<pre class="prettyprint"><code>ToSymbolicPython[
 Import[&quot;PIL&quot;];
 img=PIL.Image[];
 img.show[]
 ]

(*Out:*)

PyColumn[{PyImport[&quot;PIL&quot;],PyAssign[PySymbol[&quot;img&quot;],PyDot[PySymbol[&quot;PIL&quot;],PySymbol[Image][]]],PyDot[PySymbol[&quot;img&quot;],PySymbol[&quot;show&quot;][]]}]</code></pre>


<p>And we can see that this has built out a rather complicates structure to represent this simple program. We'll take it bit-by-bit:</p>
<pre class="prettyprint"><code>ToSymbolicPython@Import[&quot;PIL&quot;]

(*Out:*)

PyImport[&quot;PIL&quot;]</code></pre>


<p>This simply maps to a symbolic structure called  <code>PyImport</code> . If we convert that to a python string:</p>
<pre class="prettyprint"><code>PyImport[&quot;PIL&quot;]//ToPython

(*Out:*)

&quot;import PIL&quot;</code></pre>


<p>It just registers an import statement. In fact this uses  <a href="https://reference.wolfram.com/language/ref/Sow.html"><code>Sow</code></a>  to make sure the import occurs at the header of the file. This is just generally good practice.</p>
<p>Moving onto the next piece</p>
<pre class="prettyprint"><code>ToSymbolicPython[img=PIL.Image[]]

(*Out:*)

PyAssign[PySymbol[&quot;img&quot;],PyDot[PySymbol[&quot;PIL&quot;],PySymbol[Image][]]]</code></pre>


<p>This builds out a symbolic representation of this syntax. It's inspired by the low-level representation Mathematica uses:</p>
<pre class="prettyprint"><code>FullForm@Hold[img=PIL.Image[]]

(*Out:*)

Hold[Set[img,Dot[PIL,Image[]]]]</code></pre>


<p>We have a syntactic wrapper for assignment ( <code>Set</code> ) for the  <code>.</code>  accessor in python, and a conversion of Mathematica  <code>Symbol</code>  constructs into  <code>PySymbol</code>  constructs which have less ambiguity in conversion to a string.</p>
<p>Finally, taking this all together, we have a  <code>PyColumn</code>  expression which is just a mimic of Mathematica's  <code>Column</code>  function which arranges pieces line-by-line after each other. And this gives a nice way to go from Mathematica-level syntax to python code:</p>
<pre class="prettyprint"><code>ToSymbolicPython[
 Import[&quot;PIL&quot;];
 img=PIL.Image[];
 img.show[]
 ]//ToPython

(*Out:*)

&quot;import PIL\nimg = PIL.Image()\nimg.show()\n&quot;</code></pre>


<p>All it took was a long-symbolic detour.</p>
<p>As a final note, the power of this approach is in its flexibility. For instance, if we want to register new type conversions, we need only register patterns to get from a Mathematica construct to a symbolic python one. I did this for a large set of constructs, allowing one to automatically generate code for things like:</p>
<pre class="prettyprint"><code>ToSymbolicPython[
 myFunc[file]:=
  With[{x=Open[file], y=Open[file2, &quot;w+&quot;]},
   Do[y.write[line], {line, x}]
   ]
 ]//ToPython//StringTrim

(*Out:*)

&quot;def myFunc(file):\n\twith open(file) as x:\n\t\twith open(file2, 'w+') as y:\n\t\t\tfor line in x:\n\t\t\t\ty.write(line)\n\t\t\t\tNone&quot;</code></pre>


<h3>SymbolicC</h3>
<p>SymbolicC is a package built into Mathematica that works in a similar way. I'll let  <a href="https://reference.wolfram.com/language/SymbolicC/tutorial/Overview.html"><code>its documentation</code></a>  speak for it.</p>
<h3>MATLink</h3>
<p>This is a package developed by some top-tier Mathematica users to link MATLAB and Mathematica. It works on the lowest-level possible and in the most unrestricted way. This also makes it among the most powerful packages out there.</p>
<p>The basic idea is to use the  <a href="https://reference.wolfram.com/language/tutorial/WSTPAndExternalProgramCommunicationOverview.html"><code>MathLink</code></a>  system to pass  <em>packets</em>  around which encode the evaluation data desired. This is incredibly flexible but requires a lot of work to do right.</p>
<p><a id="hybrid-interfaces" style="width:0;height:0;margin:0;padding:0;">&zwnj;</a></p>
<h2>Hybrid Interfaces</h2>
<h3>Psi4</h3>
<p>I won't go into this one much, but it's a  <a href="https://github.com/b3m2a1/mathematica-ChemTools/blob/master/Packages/Psi4/Psi4Connection.m">link I provide</a>  to the software  <a href="http://www.psicode.org/">Psi4</a>  in my main chemistry package. What makes this a hybrid interface is that the basic input for Psi4 is about 80% structured so that part can be restricted, but there is also about 20% flexibility that requires a more unstructured interface. To do this I use tricks somewhere in between what I did for Git and for Python.</p>
<p>Feel free to ask me more if you have comments or questions.</p>
  </div>
</article>
<hr>
<div id="disqus_thread"></div>
<script>
  var disqus_config = function() {
    this.page.url = 'https://b3m2a1.github.io/building-external-connections-in-mathematica.html';
      this.page.identifier = 'building-external-connections-in-mathematica'
;
  };
  (function() {
    var d = document;
    var s = d.createElement('script');
    s.src = '//b3m2a1-home.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
</script>
<noscript class="text-muted">
  Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
      </div>
    </div>

  </div>

  <footer class="footer">
    <p class="col-sm-6 text-sm-right text-muted acknowledgement">
      Generated by
      <a href="https://github.com/getpelican/pelican" target="_blank">Pelican</a> /
      Forked from <a href="https://github.com/nairobilug/pelican-alchemy" target="_blank">alchemy</a>
    </p>
  </footer>

</body>

</html>